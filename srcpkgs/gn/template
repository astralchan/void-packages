# Template file for 'gn'
pkgname=gn
# Google never releases versions - give date of commit
version=07.04.2023
revision=1
_commit=ffeea1b1fd070cb6a8d47154a03f8523486b50a7
hostmakedepends="python3 ninja"
short_desc="Meta-build system that generates build files for Ninja"
maintainer="astral <astral@astralchan.xyz>"
license="BSD-3-Clause"
homepage="https://gn.googlesource.com/gn"
distfiles="https://gn.googlesource.com/gn/+archive/${_commit}.tar.gz"
checksum=4e205708436b3804e58efe463f83baed8982971e94d492b80d803e932ba3e11c

post_extract() {
	printf '#define LAST_COMMIT_POSITION "%s"\n' "${_commit}" > src/gn/last_commit_position.h
	printf '#define LAST_COMMIT_POSITION_NUM 0\n' >> src/gn/last_commit_position.h
}

pre_build() {
	python3 build/gen.py --allow-warning --no-last-commit-position
}

do_build() {
	ninja -C out
}

do_check() {
	./out/gnunittests
}

do_install() {
	vbin out/gn
}

post_install() {
	vlicense LICENSE
}
